"#!/bin/bash\nPROJECT_NAME=$1\nOPERATORS_FILE=\"/home/fff37/scripts/operators\"\nWORKDIR=\"/projects\"\nPROJECT_DIR=\"$WORKDIR/$PROJECT_NAME\"\n#rm -rf /projects/delete01/\nfunction install () {\n  apt install tree pwgen -y\n}\n\nfunction report (){\n  echo abcde\n}\n\nfunction access(){\necho \"access\"\nusers=$@\n\n\n}\n\n# echo cleaning\n# rm -rf $PROJECT_DIR\n# userdel -f -r testehandler\n# groupdel testeproject\n# groupdel operators\n\necho \"[+] Creating the directory structure\"\nif [ -e $WORKDIR ]\nthen\n  echo \"$WORKDIR FOUND\"\nelse\n  echo \"$WORKDIR missing, creating...\"\n  mkdir $WORKDIR\nfi\n\nif [ -e $PROJECT_DIR ]\nthen echo \"$PROJECT_DIR FOUND\"\n  echo \"Manual assessment is required, exiting...\"\n  exit\nelse\n  echo \"$PROJET_DIR  missing, creating...\"\n  mkdir $PROJECT_DIR\nfi\n\n#mkdir -p $PROJECT_DIR/vault\nmkdir -p $PROJECT_DIR/targets # targets/host/dumps targets/host/exploits target/host/recon\nmkdir -p $PROJECT_DIR/screenshots\nmkdir -p $PROJECT_DIR/logs\nmkdir -p $PROJECT_DIR/operators\n#HOME=\"$PROJECT_DIR/op/\"\n# git clone project template\n\n#GITURL=\"git@github.com:Unidade37/project-template.git\" #  $PROJECT_DIR/vault\n#git clone git@github.com:Unidade37/obsidian-vault-u37.git \n\n#$PROJECT_DIR/vault\n## new template 2025 - foppa 21-09-2025\ncp -rp /root/template-2025 $PROJECT_DIR/vault\n\n#git clone git@github.com:Unidade37/project-template.git  $PROJECT_DIR/vault\n#git clone git@github.com:Unidade37/project-template.git  $PROJECT_DIR/vault\n# Create a luks block\n# open\n# create the project FHS\n# set the team members permissions\n\n  check=$(getent group operators 1>/dev/null ; echo $?)\n  if [ $check -eq 0 ]; then\n     echo \"group operators already exist\"\n  else\n     echo \"creating group operators\"\n     groupadd operators\n  fi\n\n#IFS=\", \"\nfor op in $OPERATORS; do echo $op ;done\n echo $OPERATORS_FILE\nfor operator in $(cat $OPERATORS_FILE  | tr -d '\"' | cut -d \",\" -f 1,-9 );do\n  echo $operator\n  check=$(getent group $PROJECT_NAME 1>/dev/null ; echo $?)\n  if [ $check -eq 0 ]; then\n     echo \"group $PROJECT_NAME already exist\"\n  else\n     echo \"creating group $PROJECT_NAME\"\n     groupadd $PROJECT_NAME\n  fi\n  check=$(getent passwd $operator 1>/dev/null ; echo $?)\n  if [ $check -eq 0 ]; then\n     echo \"user $operator already exist, adding to group $PROJECT_NAME\"\n     usermod -aG $PROJECT_NAME $operator\n  else\n     echo \"creating user $operator\"\n     useradd -c \"Usuário de Operação\" -g operators -G $PROJECT_NAME  -s /bin/bash -m  -d /home/$operator  $operator\n     cp /home/fff37/scripts/Obsidian.desktop /home/$operator/Desktop/Obsidian.desktop\n     chown $operator:operators /home/$operator/Desktop/Obsidian.desktop\n     ln -s /projects/$PROJECT_NAME  /home/$operator/Desktop/$PROJECT_NAME\n     #useradd -c \"Usuário de Operação\" -g operators -G $PROJECT_NAME  -s /bin/sh -d $HOME/$operator $operator\n     #useradd -c \"Usuário de Operação\" -g operators -G $PROJECT_NAME -M -s /bin/sh -d /projects $operator\n     password=$(pwgen -sy 16 -N 1)\n     echo \"Seting password for user\"\n     echo $operator:$password | chpasswd\n     echo \"DONE: $operator:$password\"\n     password=\"cleaninnnggggg\"\n  fi\n#  USERLIST=\"$USERLIST $operator\"\n#  mkdir -p $PROJECT_DIR/operators/$operator\n#  cp -rp $PROJECT_DIR/vault/.obsidian \"$PROJECT_DIR/vault/.$operator\"\ndone\n\n\n# TODO - Copiar o .obsidian p/ cada operador\ntree -R -d  $PROJECT_DIR\necho \"[-] Updating the $PROJECT_DIR ACL to group $PROJECT_NAME\" \n#setfacl -R -d  g:$PROJECT_NAME:rwx $PROJECT_DIR/\nsetfacl -d -R -m g:$PROJECT_NAME:rwx $PROJECT_DIR/\n\necho \"Changing the $PROJECT_DIR ownership to root and group to $PROJECT_NAME\"\nchown -R root:$PROJECT_NAME $PROJECT_DIR\necho \"Changing the directory $PROJECT_DIR permissions to 760\"\nchmod g+ws -R $PROJECT_DIR\necho $USERLIST\n#access $USERLIST\ngetent passwd $USERLIST\ngetent group $PROJECT_NAME\n\n#echo \"Use the following command to access the SSFHS:\"\n#echo \"net use X: \\\\sshfs\\fff37@10.0.0.3\"\necho \"Configuration for Obsidian in Kasm: /share/$PROJECT_NAME/vault/\""
